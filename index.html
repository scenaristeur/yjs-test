<html>
  <body>
    <div id="status"></div>
    <input placeholder="texte Ã  ajouter" id="input" />
    <button id="button">Ajouter</button>
    <ul id="liste"></ul>
  </body>

  <script type="module">
    import * as Y from "https://cdn.jsdelivr.net/npm/yjs@13.6.14/+esm";
    import { WebsocketProvider } from "https://cdn.jsdelivr.net/npm/y-websocket@2.0.0/+esm";

    const doc = new Y.Doc();
    const liste = document.getElementById("liste");

    const wsProvider = new WebsocketProvider(
      "ws://localhost:1234",
      "my-roomname",
      doc
    );

    wsProvider.on("status", (event) => {
      // logs "connected" or "disconnected"
      console.log(event.status);
      document.getElementById("status").innerHTML = event.status;
    });

    const yarray = doc.getArray("my-array");
    yarray.observe((event) => {
       console.log(yarray.toArray());

      liste.innerHTML = "";
      for (const element of yarray.toArray()) {
        let ligne = document.createElement("li")
        ligne.innerHTML = element;
        liste.append(ligne);
      }
    });
    // every time a local or remote client modifies yarray, the observer is called
    yarray.insert(0, ["val"]); // => "yarray was modified"

    function addText() {
      const text = document.getElementById("input").value;
      yarray.insert(0, [text]);
    }
    document.getElementById("button").addEventListener("click", addText);
  </script>
</html>
